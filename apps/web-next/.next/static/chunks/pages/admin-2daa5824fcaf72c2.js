(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{577:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return i(1257)}])},1257:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return r}});var n=i(5893),l=i(7294);function r(){let[e,t]=(0,l.useState)({}),[i,r]=(0,l.useState)(!1),[d,o]=(0,l.useState)("");async function u(){try{let e=await fetch("/api/v1/admin/settings"),i=await e.json();t(i.settings||{})}catch(e){o("加载设置失败")}}function c(e,i){t(t=>({...t,[e]:i}))}async function p(){r(!0),o("");try{let t=await fetch("/api/v1/admin/settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error(await t.text());o("保存成功（已即时生效）")}catch(e){o("保存失败："+e.message)}finally{r(!1)}}async function h(e){e.preventDefault(),r(!0),o("");let t=new FormData(e.currentTarget);try{let e=await fetch("/api/v1/admin/upload",{method:"POST",body:t}),i=await e.json();if(!e.ok)throw Error(JSON.stringify(i));o("上传/索引成功："+JSON.stringify(i))}catch(e){o("上传失败："+e.message)}finally{r(!1),e.currentTarget.reset()}}return(0,l.useEffect)(()=>{u()},[]),(0,n.jsxs)("main",{style:{maxWidth:1024,margin:"24px auto",fontFamily:"system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial"},children:[(0,n.jsx)("h3",{children:"后台管理"}),(0,n.jsxs)("section",{style:{border:"1px solid #eee",padding:16,borderRadius:8},children:[(0,n.jsx)("h4",{children:"全局设置"}),(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[(0,n.jsxs)("div",{style:{border:"1px solid #f0f0f0",borderRadius:8,padding:12},children:[(0,n.jsx)("h5",{children:"模型设置"}),(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"200px 1fr",gap:8,alignItems:"center"},children:[(0,n.jsx)("label",{children:"OPENAI_CHAT_MODEL"}),(0,n.jsx)("input",{required:!0,value:e.OPENAI_CHAT_MODEL||"",onChange:e=>c("OPENAI_CHAT_MODEL",e.target.value),placeholder:"gpt-4o"}),(0,n.jsx)("label",{children:"OPENAI_EMBED_MODEL"}),(0,n.jsx)("input",{required:!0,value:e.OPENAI_EMBED_MODEL||"",onChange:e=>c("OPENAI_EMBED_MODEL",e.target.value),placeholder:"text-embedding-3-small"})]})]}),(0,n.jsxs)("div",{style:{border:"1px solid #f0f0f0",borderRadius:8,padding:12},children:[(0,n.jsx)("h5",{children:"重排设置"}),(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"200px 1fr",gap:8,alignItems:"center"},children:[(0,n.jsx)("label",{children:"COHERE_API_KEY"}),(0,n.jsx)("input",{type:"password",value:e.COHERE_API_KEY||"",onChange:e=>c("COHERE_API_KEY",e.target.value),placeholder:"可选：使用 Cohere 重排"}),(0,n.jsx)("label",{children:"COHERE_RERANK_MODEL"}),(0,n.jsx)("input",{value:e.COHERE_RERANK_MODEL||"rerank-multilingual-v3.0",onChange:e=>c("COHERE_RERANK_MODEL",e.target.value)}),(0,n.jsx)("label",{children:"RERANK_URL"}),(0,n.jsx)("input",{value:e.RERANK_URL||"",onChange:e=>c("RERANK_URL",e.target.value),placeholder:"可选：自托管重排服务地址"}),(0,n.jsx)("label",{children:"RERANK_TOKEN"}),(0,n.jsx)("input",{type:"password",value:e.RERANK_TOKEN||"",onChange:e=>c("RERANK_TOKEN",e.target.value),placeholder:"可选：重排服务鉴权"})]})]})]}),(0,n.jsxs)("div",{style:{marginTop:12},children:[(0,n.jsx)("button",{disabled:i,onClick:p,children:"保存设置"}),(0,n.jsx)("button",{disabled:i,onClick:u,style:{marginLeft:8},children:"刷新"})]})]}),(0,n.jsxs)("section",{style:{border:"1px solid #eee",padding:16,borderRadius:8,marginTop:16},children:[(0,n.jsx)("h4",{children:"文档上传与索引（支持 pdf 或 text）"}),(0,n.jsxs)("form",{onSubmit:h,children:[(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"240px 1fr",gap:8,alignItems:"center"},children:[(0,n.jsx)("label",{children:"document_id"}),(0,n.jsx)("input",{name:"document_id",required:!0,placeholder:"doc-id"}),(0,n.jsx)("label",{children:"chunk_size"}),(0,n.jsx)("input",{name:"chunk_size",type:"number",defaultValue:1800}),(0,n.jsx)("label",{children:"overlap"}),(0,n.jsx)("input",{name:"overlap",type:"number",defaultValue:0}),(0,n.jsx)("label",{children:"file"}),(0,n.jsx)("input",{name:"file",type:"file",required:!0})]}),(0,n.jsx)("div",{style:{marginTop:12},children:(0,n.jsx)("button",{disabled:i,type:"submit",children:"上传并索引"})})]})]}),(0,n.jsxs)("section",{style:{border:"1px solid #eee",padding:16,borderRadius:8,marginTop:16},children:[(0,n.jsx)("h4",{children:"URL 导入"}),(0,n.jsx)(a,{setMessage:o})]}),(0,n.jsxs)("section",{style:{border:"1px solid #eee",padding:16,borderRadius:8,marginTop:16},children:[(0,n.jsx)("h4",{children:"PDF Glob 导入"}),(0,n.jsx)(s,{setMessage:o})]}),d&&(0,n.jsx)("div",{style:{marginTop:16,padding:12,border:"1px solid #ddd",borderRadius:8,whiteSpace:"pre-wrap"},children:d})]})}function a(e){let{setMessage:t}=e,[i,r]=(0,l.useState)(""),[a,s]=(0,l.useState)(""),[d,o]=(0,l.useState)(!1);async function u(e){if(e.preventDefault(),o(!0),t(""),!i||!a){t("URL 与 document_id 必填"),o(!1);return}try{let e=await fetch("/api/v1/documents/url",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:i,document_id:a})}),n=await e.json();if(!e.ok)throw Error(JSON.stringify(n));t("URL 导入成功："+JSON.stringify(n)),r(""),s("")}catch(e){t("URL 导入失败："+e.message)}finally{o(!1)}}return(0,n.jsxs)("form",{onSubmit:u,children:[(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"240px 1fr",gap:8,alignItems:"center"},children:[(0,n.jsx)("label",{children:"url"}),(0,n.jsx)("input",{value:i,onChange:e=>r(e.target.value),placeholder:"https://example.com",required:!0}),(0,n.jsx)("label",{children:"document_id"}),(0,n.jsx)("input",{value:a,onChange:e=>s(e.target.value),placeholder:"url-1",required:!0})]}),(0,n.jsx)("div",{style:{marginTop:12},children:(0,n.jsx)("button",{disabled:d,type:"submit",children:"导入 URL"})})]})}function s(e){let{setMessage:t}=e,[i,r]=(0,l.useState)(""),[a,s]=(0,l.useState)("pdf-"),[d,o]=(0,l.useState)(!1);async function u(e){if(e.preventDefault(),o(!0),t(""),!i){t("glob 必填"),o(!1);return}try{let e=await fetch("/api/v1/documents/pdf_glob",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({glob:i,prefix:a})}),n=await e.json();if(!e.ok)throw Error(JSON.stringify(n));t("PDF Glob 导入成功："+JSON.stringify(n)),r("")}catch(e){t("PDF Glob 导入失败："+e.message)}finally{o(!1)}}return(0,n.jsxs)("form",{onSubmit:u,children:[(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"240px 1fr",gap:8,alignItems:"center"},children:[(0,n.jsx)("label",{children:"glob"}),(0,n.jsx)("input",{value:i,onChange:e=>r(e.target.value),placeholder:"/path/to/*.pdf",required:!0}),(0,n.jsx)("label",{children:"prefix"}),(0,n.jsx)("input",{value:a,onChange:e=>s(e.target.value)})]}),(0,n.jsx)("div",{style:{marginTop:12},children:(0,n.jsx)("button",{disabled:d,type:"submit",children:"导入 PDF Glob"})})]})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=577)}),_N_E=e.O()}]);