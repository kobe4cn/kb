(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(6209)}])},6209:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return s}});var a=n(5893),o=n(7294);function s(){let[e,t]=(0,o.useState)("你好，平台是什么？"),[n,s]=(0,o.useState)(""),[i,r]=(0,o.useState)([]),[l,c]=(0,o.useState)([]),d=(0,o.useRef)(null),[u,p]=(0,o.useState)(null),[h,v]=(0,o.useState)([]),[x,f]=(0,o.useState)(null),[y,g]=(0,o.useState)("");async function _(){let t=await fetch("/api/v1/query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e,top_k:3,mode:"rag"})}),n=await t.json();s(n.answer),r(n.contexts||[]),c(n.citations||[]),v(e=>["[non-stream] completed",...e])}async function m(){var t;s(""),null===(t=d.current)||void 0===t||t.close();let n=new EventSource("/api/v1/query/stream?query=".concat(encodeURIComponent(e),"&top_k=3"));n.onmessage=e=>{s(t=>t+e.data),v(t=>[e.data,...t])},n.addEventListener("text",e=>{let t=e.data;s(e=>e+t),v(e=>["[text] ".concat(t),...e])}),n.addEventListener("reasoning",e=>{let t=e.data;s(e=>e+"\n[thinking]"+t+"\n"),v(e=>["[reasoning] ".concat(t),...e])}),n.addEventListener("tool_call",e=>{let t=e.data;s(e=>e+"\n[tool_call] ".concat(t,"\n")),v(e=>["[tool_call] ".concat(t),...e])}),n.addEventListener("tool_result",e=>{let t=e.data;s(e=>e+"\n[tool_result] ".concat(t,"\n")),v(e=>["[tool_result] ".concat(t),...e])}),n.addEventListener("final",e=>n.close()),n.addEventListener("error",e=>n.close()),d.current=n}async function j(){var t;s(""),null===(t=d.current)||void 0===t||t.close();let n=await fetch("/api/v1/session/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e,top_k:3})}),{session_id:a}=await n.json();p(a),await w(a)}async function w(e){let t=new EventSource("/api/v1/session/stream?session_id=".concat(e));d.current=t;let n=new Promise(e=>{t.addEventListener("text",e=>{let t=e.data;s(e=>e+t),v(e=>["[text] ".concat(t),...e])}),t.addEventListener("reasoning",e=>{let t=e.data;s(e=>e+"\n[thinking] ".concat(t,"\n")),v(e=>["[reasoning] ".concat(t),...e])}),t.addEventListener("tool_call",async n=>{let a=n.data;f(a),g(a.startsWith("time_now")?new Date().toISOString():"client_result_for: ".concat(a)),v(e=>["[tool_call] ".concat(a),...e]),t.close(),e()}),t.addEventListener("final",n=>{t.close(),e()}),t.addEventListener("error",n=>{t.close(),e()})});await n}async function S(){if(u&&y)try{await fetch("/api/v1/session/tool_result",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:u,result:y})}),f(null),g(""),v(e=>["[tool_result] ".concat(y),...e]),await w(u)}catch(e){console.error("Failed to submit tool result:",e),v(t=>["[error] Failed to submit tool result: ".concat(e),...t])}}return(0,o.useEffect)(()=>()=>{var e;return null===(e=d.current)||void 0===e?void 0:e.close()},[]),(0,a.jsxs)("main",{style:{maxWidth:1200,margin:"24px auto",fontFamily:"system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial"},children:[(0,a.jsx)("h3",{children:"KB RAG Chat (Next.js)"}),(0,a.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,a.jsx)("input",{value:e,onChange:e=>t(e.target.value),style:{flex:1,padding:8},placeholder:"输入你的问题..."}),(0,a.jsx)("button",{onClick:_,children:"Query"}),(0,a.jsx)("button",{onClick:m,children:"SSE Stream"}),(0,a.jsx)("button",{onClick:j,children:"Client Tool Loop"})]}),(0,a.jsx)("h4",{children:"Answer"}),(0,a.jsx)("pre",{style:{whiteSpace:"pre-wrap",border:"1px solid #ddd",padding:12,borderRadius:8,minHeight:120},dangerouslySetInnerHTML:{__html:n.replace(/\[(\d+)\]/g,(e,t)=>'<a href="#ctx-'.concat(t,'">[').concat(t,"]</a>"))}}),(0,a.jsx)("h4",{children:"Contexts"}),(i||[]).map((e,t)=>(0,a.jsxs)("div",{id:"ctx-".concat(t+1),style:{background:"#f7f7ff",borderLeft:"3px solid #88f",margin:"8px 0",padding:8},children:[(0,a.jsxs)("b",{children:["[",t+1,"]"]})," ",e]},t)),(0,a.jsx)("h4",{children:"Citations"}),(l||[]).map((e,t)=>{var n;return(0,a.jsxs)("div",{style:{fontSize:12,color:"#555"},children:[e.document_id,"#",e.chunk_id," p=",null!==(n=e.page)&&void 0!==n?n:"-"," score=",e.score.toFixed(3),": ",e.snippet]},t)}),x&&(0,a.jsxs)("div",{style:{marginTop:12,padding:12,border:"1px dashed #88f"},children:[(0,a.jsxs)("div",{style:{marginBottom:6},children:["工具待执行：",x]}),(0,a.jsx)("textarea",{value:y,onChange:e=>g(e.target.value),rows:3,style:{width:"100%",padding:8}}),(0,a.jsx)("div",{style:{marginTop:8},children:(0,a.jsx)("button",{onClick:S,children:"提交工具结果"})})]}),(0,a.jsx)("h4",{children:"Tool Events"}),(0,a.jsx)("div",{style:{maxHeight:180,overflow:"auto",border:"1px solid #eee",padding:8,fontSize:12},children:h.map((e,t)=>(0,a.jsxs)("div",{children:["• ",e]},t))})]})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);