# 测试计划（高级测试）

## 范围
- 后端 API（鉴权、限流、幂等、正确性、错误处理）
- 索引流水线（采集/切分/嵌入/写入/状态机/重试）
- 查询路径（RAG/Graph/Hybrid/原文匹配）
- 评测体系（离线/在线指标）
- 可观测与告警（日志/指标/Trace）

## 测试类型与工具
- 单元测试：Rust `cargo test`；核心算法与数据结构；
- 集成测试：对接 Postgres/Qdrant/Neo4j/MinIO/OpenSearch；
- 端到端：以 `docker-compose` 启动最小集群，使用 Postman/Bruno/Rest Assured；
- 负载与容量：k6/Locust；目标 QPS、P95/P99、资源占用曲线；
- 安全：鉴权绕过、越权访问、注入、敏感数据泄露；
- RAG 质量评测：RAGAS（Faithfulness、Answer Correctness、Context Precision/Recall）。

## 用例（示例）
- 文档上传 → 任务入队 → 切分 → 嵌入 → 向量库写入 → 可查询；
- 失败重试：断网/超时/写入失败/部分成功/幂等校验；
- RAG 查询：Top-K、过滤、重排、流式返回、引用完整性；
- GraphRAG：实体/关系抽取、图构建、邻域检索、证据拼接；
- 原文匹配：精确匹配片段、高亮范围与页码定位正确；
- 多租户：隔离性/ACL；越权与租户间访问阻断；
- 观测：Trace 覆盖关键路径；指标与日志字段齐全；
- 性能：缓存命中与未命中对比；退化策略（降级/熔断）。

## 验收指标
- API 正确性 ≥ 99.9%；
- 观测覆盖：关键路径 Trace ≥ 90%；
- 负载：目标 QPS 下 P95 < 200ms（不含模型响应时延）；
- 质量：示例评测集 Recall@5 ≥ 0.8，Faithfulness ≥ 0.9（示例标准，可配置）。

## 测试数据与基线
- 小型法律/开发文档/FAQ 样本集（带金标）
- 图谱样本（实体-关系三元组）
- 热点问答缓存样本

## 自动化与报告
- CI：单元+集成测试、API 合同校验、OpenAPI 校验；
- 每日构建：E2E 烟测与性能抽样；
- 报告：趋势图、回归对比、Top 错误。

