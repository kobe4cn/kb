# 产品规划（PM）

## 目标与定位
- 提供企业级知识库管理与智能问答平台，支持 RAG 与 GraphRAG，兼容原始文档匹配（Full-text/Keyword/Exact）。
- 面向高并发、可观测与可运维场景，支持多租户与细粒度权限。
- 后端以 Rust + Rig 框架为核心，提供稳定、低时延的查询与索引服务。

## 核心价值
- 快速将散落文档转化为“可检索/可推理”的知识；
- 在生产环境稳定运行，具备监控、告警、审计与数据回溯能力；
- 通过 API 与前端界面为业务方/终端用户提供统一入口。

## 角色与用户旅程
- 系统管理员（SysAdmin）：创建租户、配置基础设施、密钥与配额。
- 知识管理员（Knowledge Ops）：配置数据源、管理文档、执行/监控索引任务。
- 分析与数据科学（DS/Analyst）：配置评测集、运行 RAG 质量评测、查看指标。
- 业务使用者（End User）：在 Web/Chat 界面或 API 查询、获取可追溯答案与引用。

## 功能清单（按模块）
1) 数据源与采集
- 文件上传：PDF/DOCX/Markdown/CSV/HTML/ZIP；
- 连接器：Web 爬取、Git/S3/MinIO、Confluence/Notion、Google Drive 等（逐步上线）；
- 版本与快照：保留变更历史，支持回滚与差分索引。

2) 文档处理流水线
- 清洗/去噪：编码修复、页面噪声移除、表格/图像占位；
- 切分策略：按语义/段落/标题/标点/窗口滑动；
- 元数据生成：来源、作者、时间、标签、访问控制；
- 嵌入与索引：向量化、写入向量库（Qdrant/SurrealDB/LanceDB/In-Memory dev）；
- 原文索引：FTS/布尔/正则；用于“原始文档匹配”。

3) GraphRAG（知识图谱）
- 知识抽取：实体/关系抽取（LLM/规则/NER），图写入（Neo4j/Memgraph/AGE）；
- 图增强检索：邻域扩展、路径约束、混合 rerank；
- 图浏览：节点/关系可视化与溯源。

4) 查询与生成
- RAG：语义检索 + 上下文组装 + 回答生成；
- GraphRAG：图检索 + 证据拼接 + 回答生成；
- 原文匹配：精确命中/片段高亮/定位页码；
- 策略：纯 RAG / 纯 Graph / Hybrid（向量+图+原文混合）；
- 可配置：Top-K、过滤项、重排序、模型与温度、流式输出。

5) 权限与合规
- 租户隔离、RBAC、密钥与配额管理；
- 审计日志、查询与生成留痕、PII 脱敏选项。

6) 观测与评测
- 在线指标：QPS、P95/P99、命中率、延迟分解；
- RAG 质量：Recall@K、MRR、Faithfulness、Answer Correctness（RAGAS）；
- 异常/失败任务追踪与重试。

7) 前端与 API
- 管理后台：数据源、文档、任务、评测、配置、监控；
- 用户界面：Chat/Search/Graph 浏览；
- 开放 API：OpenAPI + SDK（后续）

## 非功能需求（NFR）
- 性能：单实例 ≥ 1k RPS 查询（缓存命中场景），P95 < 200ms（检索侧，不含大模型）；
- 可用性：99.9%；可横向扩容，任务幂等与断点续跑；
- 安全：租户隔离、细粒度权限、密钥安全、审计合规；
- 观测：日志/指标/Trace 三件套，告警策略完善；
- 成本：可按规模渐进部署，支持本地/云端/离线模式。

## 里程碑与路线图
- M0（1–2 周）：MVP 骨架（API、索引/查询、向量库、基础前端），Qdrant + Postgres + MinIO；
- M1（2–4 周）：GraphRAG（Neo4j）、评测闭环（RAGAS）、FTS 原文匹配；
- M2（4–6 周）：多租户/RBAC、连接器扩展、缓存与限流、观测完善；
- M3（6–10 周）：多模型/弹性推理、离线批处理与增量索引、混合检索策略。

## 验收标准（MVP）
- 上传文档→切分→向量化→可检索，查询返回答案与引用；
- 原文匹配可返回片段与页码定位；
- GraphRAG 能基于抽取的实体关系提供辅助证据；
- 提供 OpenAPI 与简单前端，具备基础监控与日志。

